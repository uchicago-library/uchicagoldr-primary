<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>batch.py</title>
  <link rel="stylesheet" href="../pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>batch.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span><span class="p">,</span> <span class="n">rmdir</span><span class="p">,</span> <span class="n">mkdir</span><span class="p">,</span> <span class="n">makedirs</span><span class="p">,</span> <span class="n">walk</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">isabs</span><span class="p">,</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">isdir</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">exists</span><span class="p">,</span> <span class="n">split</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">GeneratorType</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">match</span>

<span class="kn">from</span> <span class="nn">uchicagoldr.item</span> <span class="kn">import</span> <span class="n">Item</span>
<span class="kn">from</span> <span class="nn">uchicagoldr.item</span> <span class="kn">import</span> <span class="n">AccessionItem</span>
<span class="kn">from</span> <span class="nn">uchicagoldr.bash_cmd</span> <span class="kn">import</span> <span class="n">BashCommand</span>
<span class="kn">from</span> <span class="nn">uchicagoldr.request</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">uchicagoldr.error</span> <span class="kn">import</span> <span class="n">LDRNonFatal</span><span class="p">,</span> <span class="n">LDRFatal</span>
<span class="kn">from</span> <span class="nn">uchicagoldr.output</span> <span class="kn">import</span> <span class="n">Output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>This class holds a list of files as Item instances in a new accession</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Batch</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">GeneratorType</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="n">items</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>

        <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">item</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">eq</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">():</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">eq</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">get_items</span><span class="p">():</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">eq</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">eq</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_output_self_true</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;batch&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_output_self_false</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requests</span><span class="o">=</span><span class="p">[],</span> <span class="n">errors</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;batch&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">add_request</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">add_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_item</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_item</span><span class="p">,</span> <span class="n">Item</span><span class="p">):</span>
            <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The specified object was not an item&#39;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">ProvideNewItemInstance</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">request</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">error</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_item_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output_item_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The provided index was invalid&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">ProvideNewIndex</span><span class="p">(</span><span class="n">fte</span><span class="p">)])</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_item_by_index</span><span class="p">(</span><span class="n">index</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="n">output</span><span class="o">.</span><span class="n">set_output_passed</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">output</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Item</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">ProvideNewItemInstance</span><span class="p">()])</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="n">output</span><span class="o">.</span><span class="n">set_output_passed</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">output</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">remove_item_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The provided index was invalid&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">ProvideNewIndex</span><span class="p">(</span><span class="n">fte</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">remove_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Item</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">ProvideNewItemInstance</span><span class="p">()])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">pop_item_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">pop_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="n">output</span><span class="o">.</span><span class="n">set_output_passed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">set_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">GeneratorType</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided object was not an iterable &#39;</span> <span class="o">+</span>
                                  <span class="s1">&#39;or generator&#39;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewItemsInstance</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">GeneratorType</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_items_gen</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_items_iter</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_set_items_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator_object</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generator_object</span><span class="p">,</span> <span class="n">GeneratorType</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">generator_object</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_set_items_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">some_iterable</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">some_iterable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">some_iterable</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Directory</span><span class="p">(</span><span class="n">Batch</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">directory_path</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Batch</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_directory_path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Batch</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_output_self_true</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;directory&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_output_self_false</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requests</span><span class="o">=</span><span class="p">[],</span> <span class="n">errors</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;directory&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">add_request</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">output</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">set_directory_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided path was not a string&#39;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideAbsolutePath</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="n">a_path</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided path was not absolute&#39;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideAbsolutePath</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">a_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_directory_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_walk_directory_picking_files</span><span class="p">():</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_requests</span><span class="p">():</span>
                        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LDRFatal</span><span class="p">(</span><span class="bp">NotImplemented</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_errors</span><span class="p">():</span>
                        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">add_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_item</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_item</span><span class="p">,</span> <span class="n">Item</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="s1">&#39;The provided object was not an item instance&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span>
                    <span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">ProvideNewItemInstance</span><span class="p">(</span><span class="n">fte</span><span class="p">)])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">()</span> <span class="ow">in</span> <span class="n">new_item</span><span class="o">.</span><span class="n">get_file_path</span><span class="p">()):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;Item path did not contain &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;directory path. Item not added.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
            <span class="n">Batch</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_item</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">error</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>attempts to delete the batch directory; it will fail if
the batch directory is not empty</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">clean_out_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="n">rmdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>walks a directory tree and creates a generator full of AccessionItem
instances for each regular file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_walk_directory_picking_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">flat_list</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">())</span>
        <span class="k">while</span> <span class="n">flat_list</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">flat_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">(),</span> <span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">i</span>
            <span class="k">elif</span> <span class="n">isdir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
                    <span class="n">flat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="n">child</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">StagingDirectory</span><span class="p">(</span><span class="n">Directory</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">ark</span><span class="p">,</span> <span class="n">ead</span><span class="p">,</span> <span class="n">accno</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ark</span> <span class="o">=</span> <span class="n">ark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ead</span> <span class="o">=</span> <span class="n">ead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accno</span> <span class="o">=</span> <span class="n">accno</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">ark</span><span class="p">,</span> <span class="n">ead</span><span class="p">,</span> <span class="n">accno</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">admin_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">ark</span><span class="p">,</span> <span class="n">ead</span><span class="p">,</span> <span class="n">accno</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exists_on_disk</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">directory_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">ark</span><span class="p">)</span>
        <span class="n">Directory</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_output_self_true</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;stagingdirectory&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_output_self_false</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requests</span><span class="o">=</span><span class="p">[],</span> <span class="n">errors</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;stagingdirectory&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">add_request</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The staging directory already exists!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided root either does not exist &#39;</span> <span class="o">+</span>
                                  <span class="s1">&#39;on disk or is not an absolute path.&#39;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewRoot</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="n">exists_already</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">walk</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ark</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_admin_path</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ark</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ead</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">accno</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_data_path</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ark</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ead</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">accno</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">))</span>
            <span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_admin_path</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="n">o750</span><span class="p">)</span>
            <span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_path</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="n">o750</span><span class="p">)</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_admin_path</span><span class="p">(),</span> <span class="s1">&#39;record.json&#39;</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_admin_path</span><span class="p">(),</span>
                      <span class="s1">&#39;fileConversions.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_exists_on_disk</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exists_already</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pre_existing_file</span> <span class="ow">in</span> <span class="n">exists_already</span><span class="p">:</span>
                    <span class="n">err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;A file already existed in the &quot;</span> <span class="o">+</span>
                                           <span class="s2">&quot;specified staging directory: &quot;</span> <span class="o">+</span>
                                           <span class="s2">&quot;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pre_existing_file</span><span class="p">)))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="n">err</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_data_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">set_data_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_data_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="s1">&#39;The provided data path was not a string&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">ProvideNewDataPath</span><span class="p">(</span><span class="n">fte</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="n">new_data_path</span><span class="p">):</span>
            <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided data path was not absolute&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">ProvideNewDataPath</span><span class="p">(</span><span class="n">fte</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">new_data_path</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_admin_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">admin_path</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">set_admin_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_admin_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_admin_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="s1">&#39;The provided admin path was not a string&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">ProvideNewAdminPath</span><span class="p">(</span><span class="n">fte</span><span class="p">)])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="n">new_admin_path</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided admin path was not absolute&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">ProvideNewAdminPath</span><span class="p">(</span><span class="n">fte</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">admin_path</span> <span class="o">=</span> <span class="n">new_admin_path</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">error</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_exists_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists_on_disk</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">set_exists_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newBool</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newBool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;exists_on_disk can not be set to a &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;non-boolean value&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="n">ProvideExistsOnDisk</span><span class="p">(</span><span class="n">fte</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exists_on_disk</span> <span class="o">=</span> <span class="n">newBool</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">error</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_check_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">cardinality</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">reqDirs</span><span class="o">=</span><span class="p">[],</span> <span class="n">reqFiles</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">missing_dirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">missing_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dir_contents</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">observed_cardinality</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dir_contents</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cardinality</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">observed_cardinality</span> <span class="o">!=</span> <span class="n">cardinality</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">reqDirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dir_contents</span> <span class="ow">and</span> <span class="n">isdir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">d</span><span class="p">)):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">missing_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">reqFiles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dir_contents</span> <span class="ow">and</span> <span class="n">isfile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">)):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">missing_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dir_contents</span><span class="p">,</span> <span class="n">observed_cardinality</span><span class="p">,</span>
                <span class="n">missing_dirs</span><span class="p">,</span> <span class="n">missing_files</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span>
            <span class="n">shouldBeRoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
            <span class="n">shouldBeArk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ark</span>
            <span class="n">shouldBeEAD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ead</span>
            <span class="n">shouldBeAccNo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accno</span>

            <span class="n">observedRoot</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">observedArk</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">observedEAD</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">observedAccNo</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The root directory path is not a directory &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;on disk.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Path: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">observedRoot</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">observedRoot</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">shouldBeRoot</span> <span class="o">!=</span> <span class="n">observedRoot</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The observed root does not match the root &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;specified in the object.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Observed Root: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">observedRoot</span><span class="p">)</span> <span class="o">+</span>
                                <span class="s2">&quot;Specified Root: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shouldBeRoot</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">observedArk</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">observedArk</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">shouldBeArk</span> <span class="o">!=</span> <span class="n">observedArk</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The observed ARK does not match the ARK &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;specified in the object.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Observed ARK: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">observedArk</span><span class="p">)</span> <span class="o">+</span>
                                <span class="s2">&quot;Specified ARK: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shouldBeArk</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">(</span><span class="s2">&quot;^\w{13}$&quot;</span><span class="p">,</span> <span class="n">shouldBeArk</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The observed ARK does not contain &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;13 characters.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Observed ARK: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">observedArk</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="n">ArkDirCheck</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_dir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">shouldBeRoot</span><span class="p">,</span> <span class="n">shouldBeArk</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ArkDirCheck</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The ARK directory contains more than one &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;folder.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Path: {}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">shouldBeRoot</span><span class="p">,</span>
                                                        <span class="n">shouldBeArk</span><span class="p">))</span> <span class="o">+</span>
                                <span class="s2">&quot;Contents: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ArkDirCheck</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">observedEAD</span> <span class="o">=</span> <span class="n">ArkDirCheck</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">shouldBeEAD</span> <span class="o">!=</span> <span class="n">observedEAD</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The observed EADID does not match the EADID &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;specified in the object.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Observed EADID: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">observedEAD</span><span class="p">)</span> <span class="o">+</span>
                                <span class="s2">&quot;Specified EADID: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shouldBeEAD</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="n">EADDirCheck</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_dir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">shouldBeRoot</span><span class="p">,</span> <span class="n">shouldBeArk</span><span class="p">,</span>
                                            <span class="n">shouldBeEAD</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">EADDirCheck</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The EAD directory contains more than one &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;folder.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Path: {}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">shouldBeRoot</span><span class="p">,</span>
                                                        <span class="n">shouldBeArk</span><span class="p">,</span>
                                                        <span class="n">shouldBeEAD</span><span class="p">))</span> <span class="o">+</span>
                                <span class="s2">&quot;Contents: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">EADDirCheck</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">observedAccNo</span> <span class="o">=</span> <span class="n">EADDirCheck</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">shouldBeAccNo</span> <span class="o">!=</span> <span class="n">observedAccNo</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The observed accession number does not match &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;the accession number specified in the object.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Observed Acc No: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">observedAccNo</span><span class="p">)</span> <span class="o">+</span>
                                <span class="s2">&quot;Specified Acc No: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shouldBeAccNo</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">(</span><span class="s2">&quot;^\d{4}-\d{3}$&quot;</span><span class="p">,</span> <span class="n">shouldBeAccNo</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The observed accession number does not &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;contain four digits followed by a dash &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;followed by three more digits.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Observed Acc No: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">observedAccNo</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="n">AccNoDirCheck</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_dir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">shouldBeRoot</span><span class="p">,</span> <span class="n">shouldBeArk</span><span class="p">,</span>
                                                <span class="n">shouldBeEAD</span><span class="p">,</span> <span class="n">shouldBeAccNo</span><span class="p">),</span>
                                            <span class="n">cardinality</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="n">reqDirs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
                                            <span class="p">)</span>
            <span class="k">if</span> <span class="n">AccNoDirCheck</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The observed accession number directory &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;is not properly formatted. It should &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;contain only two directories &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;&#39;admin&#39; and &#39;data&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Path: {}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">shouldBeRoot</span><span class="p">,</span>
                                                        <span class="n">shouldBeArk</span><span class="p">,</span>
                                                        <span class="n">shouldBeEAD</span><span class="p">,</span>
                                                        <span class="n">shouldBeAccNo</span><span class="p">))</span> <span class="o">+</span>
                                <span class="s2">&quot;Contents: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">AccNoDirCheck</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_validate_organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetPath</span><span class="p">,</span> <span class="n">reqTopFiles</span><span class="o">=</span><span class="p">[],</span>
                               <span class="n">reqDirContents</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">returnDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;notDirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;prefixes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;badPrefixes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;missingDirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;missingReqs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isdir</span><span class="p">(</span><span class="n">targetPath</span><span class="p">):</span>
            <span class="k">return</span><span class="p">((</span><span class="bp">False</span><span class="p">,</span> <span class="n">returnDict</span><span class="p">))</span>

        <span class="n">targetTopFileList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                             <span class="n">listdir</span><span class="p">(</span><span class="n">targetPath</span><span class="p">)</span> <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">targetPath</span><span class="p">,</span> <span class="n">x</span><span class="p">))]</span>
        <span class="n">targetFolderList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                            <span class="n">listdir</span><span class="p">(</span><span class="n">targetPath</span><span class="p">)</span> <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">targetPath</span><span class="p">,</span> <span class="n">x</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reqTopFiles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">targetTopFileList</span><span class="p">:</span>
                <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;missingReqs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">targetPath</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
                <span class="k">return</span> <span class="p">((</span><span class="bp">False</span><span class="p">,</span> <span class="n">returnDict</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">targetFolderList</span><span class="p">:</span>
            <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">targetFolderList</span> <span class="o">!=</span> <span class="n">listdir</span><span class="p">(</span><span class="n">targetPath</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">targetPath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">targetFolderList</span><span class="p">:</span>
                    <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;notDirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">targetFolderList</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span><span class="s1">&#39;^[a-zA-Z_\-]*&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;badPrefixes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;prefixes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">dirContents</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">targetPath</span><span class="p">,</span> <span class="n">x</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">reqDirContents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">req</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dirContents</span><span class="p">:</span>
                    <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;missingReqs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">targetPath</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">req</span><span class="p">))</span>

        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;prefixes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;prefixes&#39;</span><span class="p">])</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;badPrefixes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;badPrefixes&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;prefixes&#39;</span><span class="p">]:</span>
            <span class="n">prefixSet</span> <span class="o">=</span> <span class="p">[</span><span class="n">directory</span> <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">targetPath</span><span class="p">)</span>
                         <span class="k">if</span> <span class="n">match</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">prefix</span><span class="p">,</span> <span class="n">directory</span><span class="p">)]</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">prefixSet</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
            <span class="n">maxNum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxNum</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
                    <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;missingDirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;missingDirs&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">((</span><span class="bp">False</span><span class="p">,</span> <span class="n">returnDict</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;badPrefixes&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">((</span><span class="bp">False</span><span class="p">,</span> <span class="n">returnDict</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;missingReqs&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">((</span><span class="bp">False</span><span class="p">,</span> <span class="n">returnDict</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">returnDict</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_validate_contained_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">containing_folder</span><span class="p">):</span>
        <span class="n">destinationAdminRoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_admin_path</span><span class="p">()</span>
        <span class="n">destinationAdminFolder</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">destinationAdminRoot</span><span class="p">,</span> <span class="n">containing_folder</span><span class="p">)</span>
        <span class="n">destinationDataRoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_path</span><span class="p">()</span>
        <span class="n">destinationDataFolder</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">destinationDataRoot</span><span class="p">,</span> <span class="n">containing_folder</span><span class="p">)</span>

        <span class="n">existingOriginalFileHashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_fixity_log</span><span class="p">(</span>
                                         <span class="n">join</span><span class="p">(</span>
                                           <span class="n">destinationAdminFolder</span><span class="p">,</span>
                                           <span class="s1">&#39;fixityFromOrigin.txt&#39;</span>
                                         <span class="p">)</span>
                                     <span class="p">)</span>
        <span class="n">existingMovedFileHashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_fixity_log</span><span class="p">(</span>
                                     <span class="n">join</span><span class="p">(</span>
                                       <span class="n">destinationAdminFolder</span><span class="p">,</span>
                                       <span class="s1">&#39;fixityOnDisk.txt&#39;</span>
                                     <span class="p">)</span>
                                  <span class="p">)</span>

        <span class="n">notMoved</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">existingOriginalFileHashes</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existingMovedFileHashes</span><span class="p">]</span>
        <span class="n">foreignFiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">existingMovedFileHashes</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existingOriginalFileHashes</span><span class="p">]</span>
        <span class="n">badHash</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">existingOriginalFileHashes</span>
                   <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">notMoved</span> <span class="ow">and</span>
                   <span class="n">existingOriginalFileHashes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span>
                   <span class="n">existingMovedFileHashes</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>

        <span class="n">returnDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;Original File Hashes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">existingOriginalFileHashes</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;Moved File Hashes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">existingMovedFileHashes</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;Not Moved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">notMoved</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;Foreign Files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">foreignFiles</span>
        <span class="n">returnDict</span><span class="p">[</span><span class="s1">&#39;Bad Hashes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">badHash</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">notMoved</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="n">foreignFiles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="n">badHash</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">returnDict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">returnDict</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">audit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rootStatus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dataStatus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;adminStatus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;containedDirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">rootStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rootStatus</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;Your staging root structure is not valid. &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;The validator reports the following errors:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">message</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rootStatus</span><span class="o">.</span><span class="n">get_errors</span><span class="p">()]</span>
                                <span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="n">dataStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_organization</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_path</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dataStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">e_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataStatus</span><span class="p">[</span><span class="s1">&#39;badPrefixes&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">e_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Malformed Prefixes: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">dataStatus</span><span class="p">[</span><span class="s1">&#39;badPrefixes&#39;</span><span class="p">])))</span>
                    <span class="n">e_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataStatus</span><span class="p">[</span><span class="s1">&#39;missingDirs&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">e_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing Directories: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">dataStatus</span><span class="p">[</span><span class="s1">&#39;missingDirs&#39;</span><span class="p">])))</span>
                    <span class="n">e_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataStatus</span><span class="p">[</span><span class="s1">&#39;missingReqs&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">e_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing Requirements: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">dataStatus</span><span class="p">[</span><span class="s1">&#39;missingReqs&#39;</span><span class="p">])))</span>

                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;Your data directory appears to be invalid.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="n">e_str</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">adminStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_organization</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_admin_path</span><span class="p">(),</span>
                <span class="n">reqTopFiles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;record.json&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;fileConversions.txt&#39;</span><span class="p">],</span>
                <span class="n">reqDirContents</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fixityFromOrigin.txt&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;fixityOnDisk.txt&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;log.txt&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;rsyncFromOrigin.txt&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">rootStatus</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="ow">and</span> <span class="n">dataStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">adminStatus</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_path</span><span class="p">())]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                    <span class="k">assert</span><span class="p">(</span><span class="n">isdir</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;containedDirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_contained_folder</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;containedDirs&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">()</span>
                        <span class="n">e</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ouput_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">ingest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">containingFolder</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">rehash</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="s2">&quot;The provided path was not a string&quot;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewIngestTargetPath</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="s2">&quot;The provided path does not exist.&quot;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewIngestTargetPath</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided path was not a directory.&#39;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewIngestTargetPath</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">containingFolder</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;A prefix and a containing folder can not &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;be specified at the same time. A prefix &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;implies the creation of a new containing &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;folder.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">rehash</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">containingFolder</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;In order to read existing hashes you must &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;specify a containing folder that already &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;exists with hash data.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;Path syntax is incorrect. &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Paths must end with a &#39;/&#39;&quot;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewIngestTargetPath</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span><span class="o">.</span><span class="n">get_status</span><span class="p">():</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;Your staging directory is no longer valid. &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Remedy your staging directory on disk in &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;order to continue ingesting new materials.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">containingFolder</span><span class="p">:</span>
                <span class="n">prefixDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix_to_dir</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                <span class="n">workingData</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_path</span><span class="p">(),</span> <span class="n">prefixDir</span><span class="p">)</span>
                <span class="n">workingAdmin</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_admin_path</span><span class="p">(),</span> <span class="n">prefixDir</span><span class="p">)</span>
                <span class="n">mkdir</span><span class="p">(</span><span class="n">workingData</span><span class="p">)</span>
                <span class="n">mkdir</span><span class="p">(</span><span class="n">workingAdmin</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">workingData</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_path</span><span class="p">(),</span> <span class="n">containingFolder</span><span class="p">)</span>
                <span class="n">workingAdmin</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_admin_path</span><span class="p">(),</span> <span class="n">containingFolder</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">workingData</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The containing folder for the data could &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;not be found.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">workingAdmin</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;The containing folder for the admin files could &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;not be found.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_move_files_into_staging</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">workingData</span><span class="p">,</span> <span class="n">workingAdmin</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hash_files_at_origin</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">workingAdmin</span><span class="p">,</span> <span class="n">rehash</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hash_files_in_staging</span><span class="p">(</span><span class="n">workingData</span><span class="p">,</span> <span class="n">workingAdmin</span><span class="p">,</span> <span class="n">rehash</span><span class="p">)</span>
            <span class="n">add_new_items_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">add_new_items_output</span><span class="o">.</span><span class="n">get_status</span><span class="p">():</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s2">&quot;A problem occured while attempting to &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;repopulate the staging directory with an updated &quot;</span>
                                <span class="s2">&quot;listing. Errors reported follow:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">message</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                    <span class="n">add_new_items_output</span><span class="o">.</span><span class="n">get_errors</span><span class="p">()])))</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_prefix_to_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">existingPopSubDirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_getImmediateSubDirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_path</span><span class="p">())</span>
                              <span class="k">if</span> <span class="n">match</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existingPopSubDirs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dirname</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">prefix</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">existingPopSubDirs</span><span class="p">]</span>
            <span class="n">nums</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">nextNum</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nextNum</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_getImmediateSubDirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">))]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_move_files_into_staging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
                                 <span class="n">workingData</span><span class="p">,</span> <span class="n">workingAdmin</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="n">rsyncArgs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rsync&#39;</span><span class="p">,</span> <span class="s1">&#39;-avz&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">workingData</span><span class="p">]</span>
        <span class="n">rsyncCommand</span> <span class="o">=</span> <span class="n">BashCommand</span><span class="p">(</span><span class="n">rsyncArgs</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">rsyncCommand</span><span class="o">.</span><span class="n">run_command</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">workingAdmin</span><span class="p">,</span>
                       <span class="s1">&#39;rsyncFromOrigin.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rsyncCommand</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      <p>if isdir(path):
  thingsToMove = MovableItems()
  walker = FileWalker(path)
  for entry in walker:
      if match(pattern, entry):
          thingToMove = MovableItem(entry, path, workingData)
          thingsToMove.append(thingToMove)
  for thingToMove in thingsToMove:
      thingToMove.move()
      assert(thingToMove.moved)
      with open(join(workingAdmin,'mvLog.txt'),'a') as f:
          f.write(thingToMove.get_move_result())
elif isfile(path):
  thingToMove = MovableItem(path, split(path)[0], workingData)
  thingToMove.move()
  assert(thingToMove.moved)
  with open(join(workingAdmin,'mvLog.txt'),'a' as f:
      f.write(thingToMove.get_move_result())</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_hash_files_at_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">workingAdmin</span><span class="p">,</span> <span class="n">rehash</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rehash</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">workingAdmin</span><span class="p">,</span> <span class="s1">&#39;fixityFromOrigin.txt&#39;</span><span class="p">)):</span>
                <span class="n">existingHashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_fixity_log</span><span class="p">(</span>
                    <span class="n">join</span><span class="p">(</span><span class="n">workingAdmin</span><span class="p">,</span> <span class="s1">&#39;fixityFromOrigin.txt&#39;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">existingHashes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">existingHashes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">directory</span> <span class="o">=</span> <span class="n">Directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">directory</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">directory</span><span class="o">.</span><span class="n">get_items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_file_path</span><span class="p">()):</span>
                    <span class="n">directory</span><span class="o">.</span><span class="n">remove_item</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_fixity_log</span><span class="p">(</span>
            <span class="n">join</span><span class="p">(</span><span class="n">workingAdmin</span><span class="p">,</span> <span class="s1">&#39;fixityFromOrigin.txt&#39;</span><span class="p">),</span>
            <span class="n">directory</span><span class="p">,</span>
            <span class="n">existingHashes</span>
        <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_hash_files_in_staging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">workingAdmin</span><span class="p">,</span> <span class="n">rehash</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rehash</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">workingAdmin</span><span class="p">,</span> <span class="s1">&#39;fixityOnDisk.txt&#39;</span><span class="p">)):</span>
                <span class="n">existingHashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_fixity_log</span><span class="p">(</span>
                    <span class="n">join</span><span class="p">(</span><span class="n">workingAdmin</span><span class="p">,</span> <span class="s1">&#39;fixityOnDisk.txt&#39;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">existingHashes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">existingHashes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">directory</span> <span class="o">=</span> <span class="n">Directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">directory</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_fixity_log</span><span class="p">(</span>
            <span class="n">join</span><span class="p">(</span><span class="n">workingAdmin</span><span class="p">,</span> <span class="s1">&#39;fixityOnDisk.txt&#39;</span><span class="p">),</span>
            <span class="n">directory</span><span class="p">,</span>
            <span class="n">existingHashes</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_read_fixity_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">existingFixity</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="n">splitLine</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">splitLine</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">splitLine</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">go</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">splitLine</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span>
                        <span class="n">go</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">go</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">existingFixity</span><span class="p">[</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">splitLine</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">return</span> <span class="n">existingFixity</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_write_fixity_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">existingHashes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">newHashes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">directory</span><span class="o">.</span><span class="n">get_items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">find_readability</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">existingHashes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">relpath</span><span class="p">(</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">get_file_path</span><span class="p">(),</span>
                        <span class="n">start</span><span class="o">=</span><span class="n">directory</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">()</span>
                    <span class="p">)</span> <span class="ow">in</span> <span class="n">existingHashes</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="n">item</span><span class="o">.</span><span class="n">set_sha256</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">find_sha256_hash</span><span class="p">())</span>
                <span class="n">item</span><span class="o">.</span><span class="n">set_md5</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">find_md5_hash</span><span class="p">())</span>
                <span class="n">newHashes</span><span class="p">[</span><span class="n">relpath</span><span class="p">(</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">get_file_path</span><span class="p">(),</span> <span class="n">start</span><span class="o">=</span><span class="n">directory</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">()</span>
                        <span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get_sha256</span><span class="p">(),</span> <span class="n">item</span><span class="o">.</span><span class="n">get_md5</span><span class="p">()]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">newHashes</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">entry</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">newHashes</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">newHashes</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">AccessionDirectory</span><span class="p">(</span><span class="n">Directory</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">accession</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Directory</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_root_path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accession</span> <span class="o">=</span> <span class="n">accession</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_accession</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_accession</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_accession_from_relative_path</span><span class="p">()</span>
            <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">add_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Directory</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_item</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_item</span><span class="p">,</span> <span class="n">AccessionItem</span><span class="p">):</span>
            <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided object was not an &#39;</span> <span class="o">+</span>
                              <span class="s1">&#39;AccessionItem&#39;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">ProvideNewAccessionItemInstance</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">request</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">error</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Directory</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">get_root_path</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">get_root_path</span><span class="p">()</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">get_accession</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">get_accession</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_output_self_true</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;accessiondirectory&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_output_self_false</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requests</span><span class="o">=</span><span class="p">[],</span> <span class="n">errors</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;accessiondirectory&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">add_request</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_accession</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">accession</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">set_accession</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_accession</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_accession</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="s2">&quot;The provided accession was not a string&quot;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewArk</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">(</span><span class="s1">&#39;^\w{13}$&#39;</span><span class="p">,</span> <span class="n">new_accession</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRFatal</span><span class="p">(</span><span class="s2">&quot;The provided accession was not a valid ark.&quot;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewArk</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accession</span> <span class="o">=</span> <span class="n">new_accession</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_root_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_new_accession_identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url_data</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="s2">&quot;https://y1.lib.uchicago.edu/cgi-bin/minter/&quot;</span> <span class="o">+</span>
                           <span class="s2">&quot;noid?action=minter&amp;n=1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">url_data</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">url_data</span> <span class="o">=</span> <span class="n">url_data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not fetch batch identifier from &quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;RESTful NOID minter&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">url_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;61001/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_convert_to_relative_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There is no directory root on this batch!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">a_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">()</span>
            <span class="n">directory_relative_to_root</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">(</span><span class="n">a_path</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">get_root_path</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">directory_relative_to_root</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">set_root_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided root path was not a string&#39;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewRoot</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isabs</span><span class="p">(</span><span class="n">a_path</span><span class="p">):</span>
                <span class="n">fte</span> <span class="o">=</span> <span class="n">LDRNonFatal</span><span class="p">(</span><span class="s1">&#39;The provided root path was not absolute&#39;</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ProvideNewRoot</span><span class="p">(</span><span class="n">fte</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">a_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_true</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_self_false</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="p">[</span><span class="n">LDRFatal</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">find_accession_from_relative_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">a_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_relative_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">isabs</span><span class="p">(</span><span class="n">a_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot get accession from an absolute path&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">accession</span><span class="p">,</span> <span class="o">*</span><span class="n">tail</span> <span class="o">=</span> <span class="n">a_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">accession</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">collect_from_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_directory_path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_root_path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">directory_relative_to_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span> \
                                     <span class="n">_convert_to_relative_path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_accession_from_relative_path</span><span class="p">(</span><span class="n">directory_relative_to_root</span><span class="p">)</span>
        <span class="n">generator_of_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_walk_directory_picking_files</span><span class="p">(</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">generator_of_items</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_self_true</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      <p>walks a directory tree and creates a generator full of AccessionItem
instances for each regular file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_walk_directory_picking_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">flat_list</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">())</span>
        <span class="k">while</span> <span class="n">flat_list</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">flat_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_directory_path</span><span class="p">(),</span> <span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">AccessionItem</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_root_path</span><span class="p">())</span>
                <span class="k">yield</span> <span class="n">i</span>
            <span class="k">elif</span> <span class="n">isdir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
                    <span class="n">flat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="n">child</span><span class="p">))</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
